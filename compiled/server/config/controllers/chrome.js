'use strict';

var rp = require('request-promise');
var token = require('../config.js').token;
var Page = require('../models/pageModel');

module.exports = {
  newPage: function newPage(req, res) {
    var url = req.body.url;
    var title = req.body.title;

    var options = {
      uri: 'http://api.diffbot.com/v3/article',
      qs: {
        token: token,
        url: url
      },
      json: true
    };

    rp(options).then(function (data) {
      if (data.objects.length !== 0) {
        var text = data.objects[0].text;

        Page.create(title, text);
      }
    }).catch(function (err) {
      console.error(err);
    });

    res.end();
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NlcnZlci9jb25maWcvY29udHJvbGxlcnMvY2hyb21lLmpzIl0sIm5hbWVzIjpbInJwIiwicmVxdWlyZSIsInRva2VuIiwiUGFnZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJuZXdQYWdlIiwicmVxIiwicmVzIiwidXJsIiwiYm9keSIsInRpdGxlIiwib3B0aW9ucyIsInVyaSIsInFzIiwianNvbiIsInRoZW4iLCJkYXRhIiwib2JqZWN0cyIsImxlbmd0aCIsInRleHQiLCJjcmVhdGUiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImVuZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxLQUFLQyxRQUFRLGlCQUFSLENBQVg7QUFDQSxJQUFNQyxRQUFRRCxRQUFRLGNBQVIsRUFBd0JDLEtBQXRDO0FBQ0EsSUFBTUMsT0FBT0YsUUFBUSxxQkFBUixDQUFiOztBQUVBRyxPQUFPQyxPQUFQLEdBQWlCO0FBQ2ZDLFdBQVMsaUJBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQ3JCLFFBQU1DLE1BQU1GLElBQUlHLElBQUosQ0FBU0QsR0FBckI7QUFDQSxRQUFNRSxRQUFRSixJQUFJRyxJQUFKLENBQVNDLEtBQXZCOztBQUVBLFFBQU1DLFVBQVU7QUFDZEMsV0FBSyxtQ0FEUztBQUVkQyxVQUFJO0FBQ0ZaLG9CQURFO0FBRUZPO0FBRkUsT0FGVTtBQU1kTSxZQUFNO0FBTlEsS0FBaEI7O0FBU0FmLE9BQUdZLE9BQUgsRUFDR0ksSUFESCxDQUNRLFVBQUNDLElBQUQsRUFBVTtBQUNkLFVBQUlBLEtBQUtDLE9BQUwsQ0FBYUMsTUFBYixLQUF3QixDQUE1QixFQUErQjtBQUM3QixZQUFNQyxPQUFPSCxLQUFLQyxPQUFMLENBQWEsQ0FBYixFQUFnQkUsSUFBN0I7O0FBRUFqQixhQUFLa0IsTUFBTCxDQUFZVixLQUFaLEVBQW1CUyxJQUFuQjtBQUNEO0FBQ0YsS0FQSCxFQVFHRSxLQVJILENBUVMsVUFBQ0MsR0FBRCxFQUFTO0FBQ2RDLGNBQVFDLEtBQVIsQ0FBY0YsR0FBZDtBQUNELEtBVkg7O0FBWUFmLFFBQUlrQixHQUFKO0FBQ0Q7QUEzQmMsQ0FBakIiLCJmaWxlIjoiY2hyb21lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcnAgPSByZXF1aXJlKCdyZXF1ZXN0LXByb21pc2UnKTtcbmNvbnN0IHRva2VuID0gcmVxdWlyZSgnLi4vY29uZmlnLmpzJykudG9rZW47XG5jb25zdCBQYWdlID0gcmVxdWlyZSgnLi4vbW9kZWxzL3BhZ2VNb2RlbCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgbmV3UGFnZTogKHJlcSwgcmVzKSA9PiB7XG4gICAgY29uc3QgdXJsID0gcmVxLmJvZHkudXJsO1xuICAgIGNvbnN0IHRpdGxlID0gcmVxLmJvZHkudGl0bGU7XG5cbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgdXJpOiAnaHR0cDovL2FwaS5kaWZmYm90LmNvbS92My9hcnRpY2xlJyxcbiAgICAgIHFzOiB7XG4gICAgICAgIHRva2VuLFxuICAgICAgICB1cmwsXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICB9O1xuXG4gICAgcnAob3B0aW9ucylcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChkYXRhLm9iamVjdHMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgY29uc3QgdGV4dCA9IGRhdGEub2JqZWN0c1swXS50ZXh0O1xuXG4gICAgICAgICAgUGFnZS5jcmVhdGUodGl0bGUsIHRleHQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG5cbiAgICByZXMuZW5kKCk7XG4gIH0sXG59O1xuIl19